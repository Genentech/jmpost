<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="jmpost">
<title>Extending jmpost • jmpost</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending jmpost">
<meta property="og:description" content="jmpost">
<meta property="og:image" content="https://genentech.github.io/jmpost/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jmpost</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/extending-jmpost.html">Extending jmpost</a>
    <a class="dropdown-item" href="../articles/model_fitting.html">Model Fitting</a>
    <a class="dropdown-item" href="../articles/statistical-specification.html">Statistical Specifications</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://Genentech.github.io/jmpost/main">main</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/genentech/jmpost/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extending jmpost</h1>
            
      
      
      <div class="d-none name"><code>extending-jmpost.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="important">IMPORTANT<a class="anchor" aria-label="anchor" href="#important"></a>
</h2>
<p>Please note that this document is currently a work-in-progress and
does not contain complete information for this package yet.</p>
<div class="section level3">
<h3 id="custom-survival-distributions">Custom Survival Distributions<a class="anchor" aria-label="anchor" href="#custom-survival-distributions"></a>
</h3>
<p>Survival distributions in <code>jmpost</code> are specified via their
contribution to the log-hazard function. Note that at present all
distributions are implemented as proportional hazards models. This means
that for any distribution that does not have the proportional hazards
property that the distribution of any specific individual subject will
not be of the same family. That is to say the distribution family
e.g. “Log-Logistic” is just defining the baseline survival distribution
only.</p>
<p>Survival distributions are implemented as S4 classes that inherit
from <code>SurvivalModel</code>. The two main components of the
<code>SurvivalModel</code> object are the <code>stan</code> and
<code>parameters</code> slots. The <code>parameters</code> slot is a
<code>ParametersList()</code> object which is used to specify the prior
distributions of each parameter used by the survival distribution as
well as for the design matrix coefficients.</p>
<p>The <code>stan</code> slot is a <code><a href="../reference/StanModule-class.html">StanModule()</a></code> object
which needs to define the following:</p>
<ol style="list-style-type: decimal">
<li><p>In the <code>parameters</code> block each of the distributions
parameters must be formally declared.</p></li>
<li><p>In the <code>transformed parameters</code> block there must
define a vector called <code>pars_os</code> which contains one element
for each parameter used by the survival distribution.</p></li>
<li><p>In the <code>functions</code> block there must define a function
called <code>log_h0</code> which returns the log-hazard contribution.
This function must have the following signature:</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="dt">matrix</span> log_h0(<span class="dt">matrix</span> time, <span class="dt">vector</span> pars_os)</span></code></pre></div>
<p>Where: - The return matrix must be of the same dimensionality as the
<code>time</code> argument matrix where each element is the log-hazard
contribution for the corresponding timepoint in the <code>time</code>
matrix. - The <code>time</code> matrix contains one row per unique
subject and one column per timepoint for that subject - The
<code>pars_os</code> vector is as defined from (2) above and contains
the parameters for that particular distribution.</p>
<p>For example the following is roughly equivalent to how the Weibull
distribution is implemented:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SurvivalWeibullPH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">lambda</span> <span class="op">=</span> <span class="fu"><a href="../reference/prior_gamma.html">prior_gamma</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    <span class="va">gamma</span> <span class="op">=</span> <span class="fu"><a href="../reference/prior_gamma.html">prior_gamma</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    <span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StanModule-class.html">StanModule</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">        functions {</span></span>
<span><span class="st">            matrix log_h0(matrix time, vector pars_os) {</span></span>
<span><span class="st">                matrix[rows(time), cols(time)] result;</span></span>
<span><span class="st">                result = log(pars_os[1]) + log(pars_os[2]) + (pars_os[2] - 1) * log(time);</span></span>
<span><span class="st">                return result;</span></span>
<span><span class="st">            }</span></span>
<span><span class="st">        }</span></span>
<span><span class="st"></span></span>
<span><span class="st">        parameters {</span></span>
<span><span class="st">            real&lt;lower=0&gt; sm_weibull_ph_lambda;</span></span>
<span><span class="st">            real&lt;lower=0&gt; sm_weibull_ph_gamma;</span></span>
<span><span class="st">        }</span></span>
<span><span class="st"></span></span>
<span><span class="st">        transformed parameters {</span></span>
<span><span class="st">            vector[2] pars_os = [sm_weibull_ph_lambda, sm_weibull_ph_gamma]';</span></span>
<span><span class="st">        }</span></span>
<span><span class="st">    "</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/SurvivalModel-class.html">SurvivalModel</a></span><span class="op">(</span></span>
<span>        stan <span class="op">=</span> <span class="va">stan</span>,</span>
<span>        parameters <span class="op">=</span> <span class="fu"><a href="../reference/ParameterList-class.html">ParameterList</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="../reference/Parameter-class.html">Parameter</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"sm_weibull_ph_lambda"</span>, prior <span class="op">=</span> <span class="va">lambda</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/Parameter-class.html">Parameter</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"sm_weibull_ph_gamma"</span>, prior <span class="op">=</span> <span class="va">gamma</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="../reference/Parameter-class.html">Parameter</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"beta_os_cov"</span>, prior <span class="op">=</span> <span class="va">beta</span>, size <span class="op">=</span> <span class="st">"p_os_cov_design"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-link-functions">Custom Link Functions<a class="anchor" aria-label="anchor" href="#custom-link-functions"></a>
</h3>
<p>Users can define custom link functions in several ways based upon the
level of customisation required. In order to explain this process it is
first important to understand how the link functions are implemented
under the hood.</p>
<p>The link functions add their contribution to the likelihood function
via the log-hazard function; that is the general model is formulated
as:</p>
<p><span class="math display">\[
log(h_i(t, \phi_i)) = log(h_0(t)) + X_i \beta + \alpha_1 f(t, \phi_i) +
\alpha_2 g(t, \phi_i) + \dots
\]</span></p>
<p>Where: - <span class="math inline">\(X\)</span> is the design matrix
of covariates - <span class="math inline">\(\beta\)</span> is the vector
of coefficients for the covariates - <span class="math inline">\(f(t)\)</span> and <span class="math inline">\(g(t)\)</span> are the link functions - <span class="math inline">\(\alpha_1\)</span> and <span class="math inline">\(\alpha_2\)</span> are the coefficients for the
link functions - <span class="math inline">\(h_0(t)\)</span> is the
baseline hazard function - <span class="math inline">\(\phi_i\)</span>
is a vector of parameters from the longitudinal model</p>
<p>Each longitudinal model is responsible for defining their own
implementations of the <span class="math inline">\(\phi\)</span> vector.
The interface for doing this is by providing an <code>enableLink</code>
method that updates the <code>StanModule</code> object of the model to
define a Stan matrix with the name <code>link_function_inputs</code>
that contains 1 row per patient and 1 column per <span class="math inline">\(\phi\)</span> parameter.</p>
<p>For reference the following is roughly the implementation for the
<code>LongitudinalGSF</code> model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enableLink.LongitudinalGSF</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StanModule-class.html">StanModule</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">transformed parameters {</span></span>
<span><span class="st">    matrix[n_subjects, 4] link_function_inputs;</span></span>
<span><span class="st">    link_function_inputs[,1] = lm_gsf_psi_bsld;</span></span>
<span><span class="st">    link_function_inputs[,2] = lm_gsf_psi_ks;</span></span>
<span><span class="st">    link_function_inputs[,3] = lm_gsf_psi_kg;</span></span>
<span><span class="st">    link_function_inputs[,4] = lm_gsf_psi_phi;</span></span>
<span><span class="st">}"</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">stan</span>,</span>
<span>        <span class="va">stan</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>That is to say the <span class="math inline">\(\phi\)</span>
parameters for the <code>LongitudinalGSF</code> model are the 4 primary
parameters of the longitudinal model. If you wish to augment this with
additional parameters then you can subclass the
<code>LongitudinalGSF</code> model and override the
<code>enableLink</code> method with the required additional parameters
e.g.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GSFextended</span> <span class="op">&lt;-</span> <span class="kw">setClass</span><span class="op">(</span></span>
<span>    Class <span class="op">=</span> <span class="st">"GSFextended"</span>,</span>
<span>    contains <span class="op">=</span> <span class="st">"LongitudinalGSF"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">enableLink.GSFextended</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StanModule-class.html">StanModule</a></span><span class="op">(</span><span class="st">"&lt;stan-code-here&gt;"</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">stan</span>,</span>
<span>        <span class="va">stan</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, the individual link functions are implemented as Stan functions
with the following signature:</p>
<pre><code>matrix &lt;key&gt;_contrib(
  matrix time,
  matrix link_function_inputs
)</code></pre>
<p>Where: - <code>&lt;key&gt;</code> is the name of the link parameter
as specified in the <code>LinkComponent</code> object -
<code>time</code> is a matrix of 1 row per patient and 1 column per time
point to be evaluated at for that patient.</p>
<p>The <code>LinkComponent</code> object is responsible for then
integrating these functions into the final Stan model. For reference the
following is roughly the implementation of the dSLD link component for
the <code>LongitudinalRandomSlope</code> model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/LinkComponent-class.html">LinkComponent</a></span><span class="op">(</span></span>
<span>  key <span class="op">=</span> <span class="st">"link_dsld"</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="../reference/StanModule-class.html">StanModule</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">functions {</span></span>
<span><span class="st">    matrix link_dsld_contrib(</span></span>
<span><span class="st">        matrix time,</span></span>
<span><span class="st">        matrix link_function_inputs</span></span>
<span><span class="st">    ) {</span></span>
<span><span class="st">        int nrows = rows(time);</span></span>
<span><span class="st">        int ncols = cols(time);</span></span>
<span><span class="st">        vector[nrows] lm_rs_ind_rnd_slope = link_function_inputs[,2];</span></span>
<span><span class="st">        matrix[nrows, ncols] rnd_slope_mat = rep_matrix(lm_rs_ind_rnd_slope, ncols);</span></span>
<span><span class="st">        return rnd_slope_mat;</span></span>
<span><span class="st">    }</span></span>
<span><span class="st">}"</span><span class="op">)</span>,</span>
<span>  key <span class="op">=</span> <span class="st">"link_dsld"</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">prior</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can then pass these <code>LinkComponent</code> objects to the
<code>link</code> argument of the <code>JointModel</code> constructor to
add them to the model e.g.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/JointModel-class.html">JointModel</a></span><span class="op">(</span></span>
<span>  longitudinal <span class="op">=</span> <span class="fu"><a href="../reference/LongitudinalRandomSlope-class.html">LongitudinalRandomSlope</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  survival <span class="op">=</span> <span class="fu"><a href="../reference/SurvivalExponential-class.html">SurvivalExponential</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  link <span class="op">=</span> <span class="fu"><a href="../reference/LinkComponent-class.html">LinkComponent</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you wish to add multiple link functions then you must wrap them in
a <code><a href="../reference/Link-class.html">Link()</a></code> object e.g.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/JointModel-class.html">JointModel</a></span><span class="op">(</span></span>
<span>  longitudinal <span class="op">=</span> <span class="fu"><a href="../reference/LongitudinalRandomSlope-class.html">LongitudinalRandomSlope</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  survival <span class="op">=</span> <span class="fu"><a href="../reference/SurvivalExponential-class.html">SurvivalExponential</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  link <span class="op">=</span> <span class="fu"><a href="../reference/Link-class.html">Link</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/LinkComponent-class.html">LinkComponent</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/LinkComponent-class.html">LinkComponent</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For most users the above should be sufficient for adding your own
custom link functions for a specific analysis. The following explains
how to create your own generic link functions which can be useful if you
are wanting to share your code with other users or if you are building a
link function that is applicable to multiple longitudinal models and you
need polymorphism; this is only recommended for advanced users.</p>
<p>In order to avoid the user specify the exact model specific link
component we provide several generic functions that will return the
correct link component given their chosen link family. For example the
<code><a href="../reference/standard-link-user.html">linkDSLD()</a></code> function will return a different implementation
of the derivative of the SLD link depending on which longitudinal model
the user has provided. These are implemented as standard S3 methods
e.g.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linkDSLD.LongitudinalRandomSlope</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">model</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/LinkComponent-class.html">LinkComponent</a></span><span class="op">(</span></span>
<span>        key <span class="op">=</span> <span class="st">"link_dsld"</span>,</span>
<span>        stan <span class="op">=</span> <span class="fu"><a href="../reference/StanModule-class.html">StanModule</a></span><span class="op">(</span><span class="st">"&lt;stan-code-here&gt;"</span><span class="op">)</span>,</span>
<span>        prior <span class="op">=</span> <span class="va">prior</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A key design quirk to be aware of is that these methods dispatch off
of the <code>model</code> argument not the <code>prior</code> argument.
The reason for this is explained further below.</p>
<p>In order to simplify the end user API, the generic link functions
have a default <code>model</code> argument of
<code><a href="../reference/PromiseLongitudinalModel-class.html">PromiseLongitudinalModel()</a></code>. This is a special object that
is used to dispatch the
<code>link&lt;type&gt;.PromiseLongitudinalModel()</code> method which in
turn creates a <code>PromiseLinkComponent</code> object. The purpose of
these objects is to defer the creation of the <code>LinkComponent</code>
object until within the <code>JointModel</code> constructor which will
then call the <code>link&lt;Type&gt;</code> method again but with the
correct model object. As an example the following is the implementation
of the <code>linkDSLD</code> generic.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linkDSLD</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prior</span>, <span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/PromiseLongitudinalModel-class.html">PromiseLongitudinalModel</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"linkDSLD"</span>, <span class="va">model</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">linkDSLD.PromiseLongitudinalModel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prior</span> <span class="op">=</span> <span class="fu"><a href="../reference/prior_normal.html">prior_normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">model</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/PromiseLinkComponent-class.html">PromiseLinkComponent</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">linkDSLD</span>, prior <span class="op">=</span> <span class="va">prior</span>, key <span class="op">=</span> <span class="st">"link_dsld"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">linkDSLD.default</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prior</span>, <span class="va">model</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Method `linkDSLD` is not available for `%s`"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For reference the <code>JointModel</code> constructor will then
attempt to resolve the promise by executing the provided function
against the user provided longitudinal model object e.g.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>object<span class="sc">@</span><span class="fu">fun</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="at">prior =</span> object<span class="sc">@</span>prior,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="at">model =</span> <span class="sc">&lt;</span>longitudinal<span class="sc">-</span>model<span class="sc">&gt;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="formatting-stan-files">Formatting Stan Files<a class="anchor" aria-label="anchor" href="#formatting-stan-files"></a>
</h3>
<p>Under the hood this library works by merging multiple Stan programs
together into a single program. It does this by parsing the program to
extract out each block independently. Unfortunately, the formal Stan
parser (<code>stanc</code>) provided by the Stan team only works with
complete programs whereas most of the programs within
<code>jmpost</code> are incomplete fragments. This package has therefore
implemented its own simple parser; as a result, in order to not have to
traverse the full abstract syntax tree (AST), a few addition constraints
are made on how Stan programs can be formatted.</p>
<p>These additional constraints are:</p>
<ul>
<li>The opening to each block must start on a newline and can’t have any
non-whitespace character proceeding it.</li>
<li>The opening to each block cannot have any non-whitespace characters
after the opening <code>{</code> character.</li>
<li>The closing <code>}</code> character after each block cannot have
any non-whitespace characters after it</li>
</ul>
<p>Valid:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="dt">int</span> n; <span class="dt">array</span>[n] <span class="dt">real</span> x;</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>}       </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="kw">parameters</span>{      </span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="dt">real</span> mu; </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="dt">real</span> sigma;}</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    <span class="kw">model</span> {    </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>x ~ normal(mu, sigma);</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    }    </span></code></pre></div>
<p>Invalid:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co">// non-whitespace after opening `{`</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="kw">data</span> { <span class="dt">int</span> n; <span class="dt">array</span>[n] <span class="dt">real</span> x; } </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>parameter { <span class="dt">real</span> mu;      <span class="co">// non-whitespace after opening `{`</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="dt">real</span> sigma;</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>} <span class="kw">model</span> {                 <span class="co">// non-whitespace before block name</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  x ~ normal(mu, sigma);</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>} <span class="co">// some comment         // non-whitespace after closing `}`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stan-data-objects">Stan Data Objects<a class="anchor" aria-label="anchor" href="#stan-data-objects"></a>
</h3>
<p>When writing your own Stan code to extend <code>jmpost</code> it is
important to note that many different data objects have already been
defined in the <code>data</code> block of the base Stan template. This
section outlines the different data objects that are made available to
user. Note that some objects are only made available if the
corresponding model is used; for example death times are only available
if the user specifies a <code>SurvivalModel</code> object to
<code><a href="../reference/JointModel-class.html">JointModel()</a></code>.</p>
<div class="section level4">
<h4 id="global-data-objects">Global Data Objects<a class="anchor" aria-label="anchor" href="#global-data-objects"></a>
</h4>
<p><strong>Number of unique subjects</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_subjects;</span></code></pre></div>
<p><strong>Number of unique studies</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_studies;</span></code></pre></div>
<p><strong>Number of unique treatment arms</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_arms;</span></code></pre></div>
<p><strong>Study index for each subject</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="dt">array</span>[n_subjects] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>,<span class="kw">upper</span>=n_studies&gt; subject_study_index;</span></code></pre></div>
<ul>
<li>Note that this is sorted based upon the subject’s factor level
within the R <code>data.frame</code>. For example lets say subject
<code>"A"</code> has a factor level of 15 and that their corresponding
study value has a factor level of 2 then
<code>subject_study_index[15]</code> will be 2.</li>
</ul>
<p><strong>Treatment arm index for each subject</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>  <span class="dt">array</span>[n_subjects] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>,<span class="kw">upper</span>=n_arms&gt; subject_arm_index;</span></code></pre></div>
<ul>
<li>A mirror of <code>subject_study_index</code> but for the treatment
arm.</li>
</ul>
</div>
<div class="section level4">
<h4 id="survival-data-objects">Survival Data Objects<a class="anchor" aria-label="anchor" href="#survival-data-objects"></a>
</h4>
<p><strong>Number of events</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_subject_event;</span></code></pre></div>
<p><strong>Event/Censor Times</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="dt">vector</span>[n_subjects] event_times;</span></code></pre></div>
<ul>
<li>Ordered by patient factor level</li>
</ul>
<p><strong>Event Index</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="dt">array</span>[n_subject_event] <span class="dt">int</span> subject_event_index;</span></code></pre></div>
<ul>
<li>Is the index into <code>event_times</code> to identify which times
are an event. The rest are censored.</li>
</ul>
<p><strong>Number of covariates for the survival model</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; p_os_cov_design;</span></code></pre></div>
<ul>
<li>Note that this does not include an intercept term, which would
conflict with the baseline distribution parameters.</li>
</ul>
<p><strong>Covariate design matrix for the survival model</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="dt">matrix</span>[n_subjects, p_os_cov_design] os_cov_design;</span></code></pre></div>
<ul>
<li>Note that this does not include an intercept term, which would
conflict with the baseline distribution parameters.</li>
</ul>
<p><strong>Time &gt;0 flag</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="dt">array</span>[rows(event_times)] <span class="dt">int</span> time_positive_flag;</span></code></pre></div>
<p><strong>Number of times &gt;0</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="dt">int</span> n_times_positive;</span></code></pre></div>
<p><strong>Positive time index</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="dt">array</span>[n_times_positive] <span class="dt">int</span> time_positive_index</span></code></pre></div>
<p><strong>Gaussian Quadrature Integration Parameters</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_nodes;</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="dt">vector</span>[n_nodes] nodes;</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt;[n_nodes] weights;</span></code></pre></div>
<ul>
<li>These are the nodes and weights for the Gaussian quadrature
integration.</li>
</ul>
</div>
<div class="section level4">
<h4 id="longitudinal-data-objects">Longitudinal Data Objects<a class="anchor" aria-label="anchor" href="#longitudinal-data-objects"></a>
</h4>
<p><strong>Total number of tumour assessments</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_tumour_all;</span></code></pre></div>
<p><strong>Number of tumour assessments above LLoQ (Lower Limit of
Quantification)</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_tumour_obs;</span></code></pre></div>
<p><strong>Number of tumour assessments below LLoQ (Lower Limit of
Quantification)</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_tumour_cens;</span></code></pre></div>
<p><strong>Tumour assessments values</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="dt">vector</span>[n_tumour_all] tumour_value;</span></code></pre></div>
<p><strong>Tumour assessments time points</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="dt">vector</span>[n_tumour_all] tumour_time;</span></code></pre></div>
<p><strong>LLoQ threshold</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="dt">real</span> tumour_value_lloq;</span></code></pre></div>
<p><strong>Individual tumour assessment index</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="dt">array</span>[n_tumour_all] <span class="dt">int</span> subject_tumour_index;</span></code></pre></div>
<ul>
<li>That is if tumour assessment 1 belongs to the patient with factor
level 3 then <code>subject_tumour_index[1]</code> will be 3.</li>
</ul>
<p><strong>Tumour assessment index for observations above LLoQ (Lower
Limit of Quantification)</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="dt">array</span>[n_tumour_obs] <span class="dt">int</span> subject_tumour_index_obs;</span></code></pre></div>
<ul>
<li>For example if only tumour assessments 3 and 5 were above the LLoQ
then <code>subject_tumour_index_obs</code> will be
<code>[3, 5]</code>.</li>
</ul>
<p><strong>Tumour assessment index for observations below LLoQ (Lower
Limit of Quantification)</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="dt">array</span>[n_tumour_cens] <span class="dt">int</span> subject_tumour_index_cens;</span></code></pre></div>
<ul>
<li>For example if only tumour assessments 1 and 2 were below the LLoQ
then <code>subject_tumour_index_obs</code> will be
<code>[1, 2]</code>.</li>
</ul>
<p><strong>Sparse matrix components for patient indexes of the tumour
assessments</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="dt">array</span> [<span class="dv">3</span>] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_mat_inds_all_y;</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="dt">vector</span>[n_mat_inds_all_y[<span class="dv">1</span>]] w_mat_inds_all_y;</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_all_y[<span class="dv">2</span>]] <span class="dt">int</span> v_mat_inds_all_y;</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_all_y[<span class="dv">3</span>]] <span class="dt">int</span> u_mat_inds_all_y;</span></code></pre></div>
<ul>
<li>This is the sparse matrix representation of the binary matrix that
has one row per patient and one column per tumour assessment. That is,
for row 3 of this matrix all columns that have an entry of 1 indicate
that the corresponding entry in <code>tumour_value</code> belongs to the
patient with factor level 3. This matrix is primarily used to calculate
the sum of log-likelihood for all tumour assessments per patient in an
efficient way.</li>
<li>See <a href="https://mc-stan.org/docs/functions-reference/sparse_matrix_operations.html#CSR" class="external-link">the
Stan CSR documentation</a> for more information on the sparse matrix
representation.</li>
</ul>
<p><strong>Sparse matrix components for patient indexes of the tumour
assessments above the LLoQ</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="dt">array</span> [<span class="dv">3</span>] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_mat_inds_obs_y;</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="dt">vector</span>[n_mat_inds_obs_y[<span class="dv">1</span>]] w_mat_inds_obs_y;</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_obs_y[<span class="dv">2</span>]] <span class="dt">int</span> v_mat_inds_obs_y;</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_obs_y[<span class="dv">3</span>]] <span class="dt">int</span> u_mat_inds_obs_y;</span></code></pre></div>
<ul>
<li>Same as above but only for the tumour assessments above the
LLoQ.</li>
</ul>
<p><strong>Sparse matrix components for patient indexes of the tumour
assessments below the LLoQ</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="dt">array</span> [<span class="dv">3</span>] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_mat_inds_cens_y;</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="dt">vector</span>[n_mat_inds_cens_y[<span class="dv">1</span>]] w_mat_inds_cens_y;</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_cens_y[<span class="dv">2</span>]] <span class="dt">int</span> v_mat_inds_cens_y;</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="dt">array</span>[n_mat_inds_cens_y[<span class="dv">3</span>]] <span class="dt">int</span> u_mat_inds_cens_y;</span></code></pre></div>
<ul>
<li>Same as above but only for the tumour assessments below the
LLoQ.</li>
</ul>
</div>
<div class="section level4">
<h4 id="global-quantity-data-objects">Global Quantity Data Objects<a class="anchor" aria-label="anchor" href="#global-quantity-data-objects"></a>
</h4>
<p><strong>Number of quantities to be generated</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="dt">int</span> &lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; gq_n_quant;</span></code></pre></div>
<p><strong>Assessment time for that the corresponding quantity should be
generated at</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="dt">vector</span>[gq_n_quant] gq_times;</span></code></pre></div>
<p><strong>Patient index for each quantity</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="dt">array</span>[gq_n_quant] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=n_subjects&gt; gq_pt_index;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridFixed()</a></code> / <code><a href="../reference/Grid-Functions.html">GridGrouped()</a></code> /
<code><a href="../reference/Grid-Functions.html">GridObserved()</a></code> / <code><a href="../reference/Grid-Functions.html">GridManual()</a></code> only</li>
</ul>
</div>
<div class="section level4">
<h4 id="survival-quantity-data-objects">Survival Quantity Data Objects<a class="anchor" aria-label="anchor" href="#survival-quantity-data-objects"></a>
</h4>
<p><strong>Number of link parameters</strong></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; gq_n_par;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridPrediction()</a></code> only</li>
</ul>
<p><strong>Matrix of link function inputs</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="dt">matrix</span>[gq_n_quant, gq_n_par] gq_link_function_inputs;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridPrediction()</a></code> only</li>
</ul>
<p><strong>Design matrix for the survival quantity model</strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="dt">matrix</span>[gq_n_quant, p_os_cov_design] gq_os_cov_design;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridPrediction()</a></code> only</li>
</ul>
</div>
<div class="section level4">
<h4 id="longitudinal-quantity-data-objects">Longitudinal Quantity Data Objects<a class="anchor" aria-label="anchor" href="#longitudinal-quantity-data-objects"></a>
</h4>
<p><strong>Arm index for each quantity</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="dt">array</span> [gq_n_quant] <span class="dt">int</span> &lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=n_arms&gt; gq_long_pop_arm_index;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridPopulation()</a></code> only</li>
</ul>
<p><strong>Study index for each quantity</strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="dt">array</span> [gq_n_quant] <span class="dt">int</span> &lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=n_studies&gt; gq_long_pop_study_index;</span></code></pre></div>
<ul>
<li>
<code><a href="../reference/Grid-Functions.html">GridPopulation()</a></code> only</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Craig Gower-Page, Georgios Kazantzidis, Daniel Sabanes Bove, Xiaoyan Fang, Francois Mercier, Isaac Gravestock, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
